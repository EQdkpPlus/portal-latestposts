<?php/* * Project:     EQdkp-Plus * License:     Creative Commons - Attribution-Noncommercial-Share Alike 3.0 Unported * Link:		    http://creativecommons.org/licenses/by-nc-sa/3.0/ * ----------------------------------------------------------------------- * Began:       2008 * Date:        $Date: 2008-12-02 13:38:01 +0100 (Di, 02 Dez 2008) $ * ----------------------------------------------------------------------- * @author      $Author: wallenium $ * @copyright   2006-2008 Corgan - Stefan Knaak | Wallenium & the EQdkp-Plus Developer Team * @link        http://eqdkp-plus.com * @package     eqdkp-plus * @version     $Rev: 3294 $ *  * $Id: module.php 3294 2008-12-02 12:38:01Z wallenium $ */if ( !defined('EQDKP_INC') ){    header('HTTP/1.0 404 Not Found');exit;}$portal_module['latestposts'] = array(			'name'			    => 'Latest Forum Posts',			'path'			    => 'latestposts',			'version'		    => '1.0.0',			'author'        => 'WalleniuM',			'contact'		    => 'http://www.eqdkp-plus.com',			'description'   => 'See the latest Forum Posts',			'positions'     => array('middle'),      'install'       => array(			                            'autoenable'        => '0',    // 0 = disable on install , 1 = enable on install			                            'defaultposition'   => 'middle',// see blocks above			                            'defaultnumber'     => '1',    // default ordering number			                            'visibility'        => '0',    // 0 = all users, 1 = guests only, 2 = signed in only			                            'collapsable'       => '1',    // Module Collapsable or not? Default == 1                                  ),    );$portal_settings['latestposts'] = array(  'pk_latestposts_amount'     => array(        'name'      => 'pk_latestposts_amount',        'language'  => 'pk_latestposts_amount',        'property'  => 'text',        'size'      => '6',        'help'      => '',      ),  'pk_latestposts_bbmodule'     => array(        'name'      => 'pk_latestposts_bbmodule',        'language'  => 'pk_latestposts_bbmodule',        'property'  => 'dropdown',        'help'      => '',        'options'   => array(                          'phpbb3.php'    => 'phpBB3',                        )      ),  'pk_latestposts_bbpath'     => array(        'name'      => 'pk_latestposts_bbpath',        'language'  => 'pk_latestposts_bbpath',        'property'  => 'text',        'size'      => '30',        'help'      => '',      ),   'pk_latestposts_newdb'     => array(        'name'      => 'pk_latestposts_newdb',        'language'  => 'pk_latestposts_newdb',        'property'  => 'checkbox',        'size'      => '30',        'help'      => '',      ),         'pk_latestposts_dbhost'     => array(        'name'      => 'pk_latestposts_dbhost',        'language'  => 'pk_latestposts_dbhost',        'property'  => 'text',        'size'      => '30',        'help'      => '',      ),   'pk_latestposts_dbname'     => array(        'name'      => 'pk_latestposts_dbname',        'language'  => 'pk_latestposts_dbname',        'property'  => 'text',        'size'      => '30',        'help'      => '',      ),   'pk_latestposts_dbuser'     => array(        'name'      => 'pk_latestposts_dbuser',        'language'  => 'pk_latestposts_dbuser',        'property'  => 'text',        'size'      => '30',        'help'      => '',      ),   'pk_latestposts_dbpassword'     => array(        'name'      => 'pk_latestposts_dbpassword',        'language'  => 'pk_latestposts_dbpassword',        'property'  => 'text',        'size'      => '30',        'help'      => '',      ),   'pk_latestposts_dbprefix'     => array(        'name'      => 'pk_latestposts_dbprefix',        'language'  => 'pk_latestposts_dbprefix',        'property'  => 'text',        'size'      => '30',        'help'      => '',      ),);if(!function_exists(latestposts_module)){  function latestposts_module(){  	global $eqdkp , $user , $tpl, $db, $plang, $conf_plus, $wherevalue, $sql_db;  	// Initiate the new Database Connection if needed  	if($conf_plus['pk_latestposts_newdb'] == 1){      $mydb = new $sql_db();      $mydb->sql_connect($conf_plus['pk_latestposts_dbhost'], $conf_plus['pk_latestposts_dbname'], $conf_plus['pk_latestposts_dbuser'], $conf_plus['pk_latestposts_dbpassword'], false);    }else{      $mydb = $db;    }  	  	// include the BB Module File...  	$bbModule = $eqdkp_root_path . 'portal/latestposts/bb_modules/'.$conf_plus['pk_latestposts_bbmodule'];  	if(is_file($bbModule)){      include($bbModule);      if(!$myBBquery){        return $plang['portal_latestposts_invmodule'];      }    }else{      return $plang['portal_latestposts_nomodule'];    }        // Middle Output    if($wherevalue == 'middle'){      $myOut = "<table cellpadding='3' cellSpacing='2' width='100%'>                <tr>                  <th width='60%'>".$plang['pk_latestposts_title']."</th>                  <th width='10%'>".$plang['pk_latestposts_posts']."</th>                  <th width='30%' colspan='2'>".$plang['pk_latestposts_lastpost']."</th>                </tr>";      if($bb_result = $mydb->query($myBBquery)){        while($row = $mydb->fetch_record($bb_result)){          $myOut .= "<tr valign='top' class='".$eqdkp->switch_row_class()."''>                      <td>                        <a href='".bbLinkGeneration('topic', $row)."' target='_blank'>".$row['bb_topic_title']."</a>                      </td>                      <td align='center'>".$row['bb_replies']."</td>                      <td>".date('d.m.Y, H:i', $row['bb_posttime'])."</td>                      <td><a href='".bbLinkGeneration('member', $row)."' target='_blank'>".$row['bb_username']."</a> <a href='".bbLinkGeneration('topic', $row)."' target='_blank'><img src='".$eqdkp_root_path."portal/latestposts/images/icon_topic_latest.gif' /></a></td>                    </tr>";        }      }else{        $myOut .= "<tr valign='top'>                      <td colspan='3'>".$plang['pk_latestposts_noentries']."</td                    </tr>";      }      $myOut .= "</table>";    }else{      // Sidebar Output      $myOut = '';    }    return $myOut;  }}?>